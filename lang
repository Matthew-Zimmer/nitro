
table TABLE {
  id uuid pk,
  name str,
}

func component(value: str): html {
  <div hx-get="/hello?name={value}" hx-swap=outerHTML class="border p-4">
    {value}
  </div>
}

func admin(req: request, response: response) {
  let user_id = match extract_user(req) {
    case some(id) => id,
    case none => stop(401, "")!,
  }

  match select count(*) > 0 from TABLE where id = {user_id} {
    case [true] => next
    case [false] => stop(401, "current user is not an admin")
  }
} 

get / (): html {
  let [data] =
    select 
      * 
    from TABLE
    limit 1

  <component value={data.name}/>
}

get /hello (): html {
  "Hello"
}

@admin
get /entity/{id}/friends (): html {
  <div>You have no friends</div>
}


